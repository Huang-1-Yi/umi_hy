conda activate robodiff
conda activate umi


cd diffusion_policy
python eval_real_robot.py -i data/pusht/checkpoints/latest.ckpt  -o data/eval_pusht_real --robot_ip 172.16.0.11



export QT_QPA_PLATFORM=xcb

python run_slam_pipeline.py umi/example_demo_session


python scripts_slam_pipeline/07_generate_replay_buffer.py -o example_demo_session/place_wood_box_0830.zarr.zip example_demo_session
accelerate launch --num_processes 2 train.py --config-name=train_diffusion_unet_umi_place_cup_workspace task.dataset_path=example_demo_session/place_wood_box_0830.zarr.zip



conda activate umi
HYDRA_FULL_ERROR=1 
accelerate launch --num_processes 2 train.py --config-name=train_diffusion_unet_umi_place_cup_workspace_resume +checkpoint_path=data/outputs/2024.08.05/01.35.23_train_diffusion_unet_timm_umi task.dataset_path=example_demo_session/place_small_cup_0805.zarr.zip


æµ‹è¯•
python eval_real_franka_left.py -rc=example/eval_robots_config_franka.yaml -i model/wood1_tf/epoch=0180-train_loss=0.012.ckpt  -o data/franka_test/1011





python eval_real_ur_left.py -rc=example/eval_robots_config_ur.yaml -i epoch=0380-train_loss=0.011.ckpt  -o data/place_wood3_box/0905



python eval_real_ur_left.py -rc=example/eval_robots_config_ur.yaml -i place_small_cup_ckpt/epoch=0190-train_loss=0.011.ckpt -o data/place_cup_ckpt/eval_0731

python run_slam_pipeline.py umi/example_demo_session
python scripts_slam_pipeline/07_generate_replay_buffer.py -o example_demo_session/dataset.zarr.zip example_demo_session

python eval_real_ur_left.py -rc=example/eval_robots_config_ur.yaml -i place_small_cup_ckpt/epoch=0190-train_loss=0.011.ckpt -o data/place_small_cup_ckpt/eval_0831








ur
conda activate umi
 sudo chmod 777 /dev/bus/usb/002/002

python eval_real_franka_left.py -rc=example/eval_robots_config_franka.yaml -i place_small_cup_ckpt/epoch=0190-train_loss=0.011.ckpt -o data/place_cup_ckpt/eval_0731

192.168.1.13






python eval_real_ur_left.py -rc=example/eval_robots_config_ur.yaml -i place_small_cup_ckpt/epoch=0190-train_loss=0.011.ckpt -o data/place_cup_ckpt/eval_0731

python eval_real_ur_left.py -rc=example/eval_robots_config_ur.yaml -i place_cup_ckpt/epoch=0290-train_loss=0.011.ckpt -o data/place_cup_ckpt/eval_0731




conda activate umi
cd ~/umi
python eval_real.py --robot_config=example/eval_robots_config_ur.yaml -i place_cup_ckpt/epoch=0290-train_loss=0.011.ckpt -o data/place_cup_ckpt/eval_0716

python eval_real_ur.py -rc=example/eval_robots_config_ur.yaml -i place_cup_ckpt/epoch=0290-train_loss=0.011.ckpt -o data/place_cup_ckpt/eval_0731

python eval_real_relman_left.py -rc=example/eval_robots_config.yaml -i place_cup_ckpt/epoch=0290-train_loss=0.011.ckpt -o data/place_cup_ckpt/eval_0822


# å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†é€€å‡ºé”®ï¼ˆqï¼‰ï¼Œåˆ™ç»“æŸå½“å‰å‰§é›†ï¼Œé€€å‡ºç¨‹åº
# ç”¨æˆ·æŒ‰ä¸‹äº†åˆ‡æ¢åˆ°ç­–ç•¥æ§åˆ¶é”®ï¼ˆcï¼‰ï¼Œåˆ™åˆ‡æ¢åˆ°ç­–ç•¥æ§åˆ¶
# å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†ä¸‹ä¸€é›†é”®ï¼ˆeï¼‰ï¼Œåˆ™ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå‰§é›†
# å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†ä¸Šä¸€é›†é”®ï¼ˆwï¼‰ï¼Œåˆ™ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªå‰§é›†
# å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†ç§»åŠ¨æœºå™¨äººé”®ï¼ˆmï¼‰ï¼Œåˆ™ä¸ºæœºå™¨äººå¤¹çˆªè®¾ç½®ä¸€ä¸ªè·¯å¾„ç‚¹ï¼Œå¤¹çˆªå°†åœ¨ç»™å®šæ—¶é—´åˆ°è¾¾æŒ‡å®šå®½åº¦ï¼Œéœ€è¦ä½ç½®
# å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†é€€æ ¼é”®ï¼Œåˆ™å¼¹å‡ºä¸€ä¸ªç¡®è®¤æ¡†ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦åˆ é™¤å½“å‰å‰§é›†
# å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†åˆ‡æ¢æ§åˆ¶æœºå™¨äººé”®ï¼ˆaï¼‰ï¼Œåˆ™è®¾ç½®æ§åˆ¶æœºå™¨äººç´¢å¼•åˆ—è¡¨ä¸ºæ‰€æœ‰æœºå™¨äºº
# å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†é€‰æ‹©æœºå™¨äºº1é”®ï¼ˆ1ï¼‰ï¼Œåˆ™è®¾ç½®æ§åˆ¶æœºå™¨äººç´¢å¼•åˆ—è¡¨åªåŒ…å«æœºå™¨äºº1
# å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†é€‰æ‹©æœºå™¨äºº2é”®ï¼ˆ2ï¼‰ï¼Œåˆ™è®¾ç½®æ§åˆ¶æœºå™¨äººç´¢å¼•åˆ—è¡¨åªåŒ…å«æœºå™¨äºº2


å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº†å¼€å§‹ç­–ç•¥æ§åˆ¶é”®ï¼ˆsï¼‰ï¼Œåˆ™


conda activate umi
cd ~/umi
python umi/real_world/launch_realman_interface_server.py


conda activate umi
cd ~/umi
python eval_real_relman_left.py --robot_config=example/eval_robots_config.yaml -i place_cup_ckpt/latest.ckpt -o data/place_cup_ckpt/eval_0716




python eval_real_relman_left.py --robot_config=example/eval_robots_config.yaml -i latest.ckpt -o data/eval_0614


ç›¸æœºå»¶è¿Ÿæµ‹é‡0.14
python scripts/calibrate_uvc_camera_latency.py
æœºæ¢°è‡‚å»¶è¿Ÿæµ‹é‡
python umi/real_world/launch_realman_interface_server.py
python scripts/calibrate_robot_latency.py 



python eval_real_relman.py --robot_config=example/eval_robots_config.yaml -i epoch=0100-train_loss=0.019.ckpt -o data/eval_0516


python umi/real_world/launch_realman_interface_server.py

å•æ‰‹
python eval_real_left.py  + -i cup_wild_vit_l.ckpt -o data/eval_cup_wild_example



python scripts_real/eval_real_umi.py -i data/outputs/2023.10.26/02.25.30_train_diffusion_unet_timm_umi/checkpoints/latest.ckpt -o data_local/cup_test_data
python scripts_real/eval_real_umi.py -i data/outputs/2023.10.26/02.25.30_train_diffusion_unet_timm_umi/checkpoints/latest.ckpt -o data_local/cup_test_data




python scripts_real/eval_real_umi.py -i data/outputs/2023.10.26/02.25.30_train_diffusion_unet_timm_umi/checkpoints/latest.ckpt -o data_local/cup_test_data



hy
python eval_real.py --robot_config=example/eval_robots_config.yaml -i cup_wild_vit_l.ckpt -o data/eval_cup_wild_example





åŸºç¡€ç¯å¢ƒubuntu20.04.06ï¼Œå†…å’Œ5.15.0.100.geneic
ros-noetic
nvidia535
cuda11.8


wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run
sudo sh cuda_11.8.0_520.61.05_linux.run

wget https://developer.download.nvidia.com/compute/cuda/12.1.1/local_installers/cuda_12.1.1_530.30.02_linux.run
sudo sh cuda_12.1.1_530.30.02_linux.run
ä¸€é”®å®‰è£…ros+é…ç½®ç¯å¢ƒ
sudo apt-get update
sudo apt-get upgrade
wget http://fishros.com/install -O fishros && . fishros 
é€‰æ‹©ï¼š1+2+7

åªèƒ½åœ¨/etc/apt/sources.listä¸­æ·»åŠ ä¸€ç§ç±»å‹çš„æºï¼Œæ¯”å¦‚åªæ·»åŠ é˜¿é‡Œæºæˆ–è€…æ¸…åæºï¼Œåˆ«æŠŠä¸¤ç§éƒ½æè¿›å»ï¼Œä¼šå‡ºé”™çš„ï¼åŒç†ï¼Œä¹Ÿåˆ«è·Ÿå…¶ä»–çš„æºæ··åœ¨ä¸€èµ·æè¿›å»ï¼

ä¸€ã€conda+docker
1.1å®‰è£…
cd /opt
sudo wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh
sudo bash Miniconda3-latest-Linux-x86_64.sh
å¤‡æ³¨ï¼šé€‰é¡¹ï¼š[/root/miniconda3] >>> /opt/miniconda3
export PATH="/opt/miniconda3/bin:$PATH"
conda init
1.2ä¿®æ”¹.condarc
{}

channels:
Â  - defaults
custom_channels:
Â  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
Â  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
Â  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
Â  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
Â  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
Â  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
default_channels:
Â  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
Â  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
Â  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
show_channel_urls: True

1.3 docker

https://docs.docker.com/engine/install/ubuntu/

# Add Docker's official GPG key:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update

sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo docker run hello-world

https://docs.docker.com/engine/install/linux-postinstall/

sudo groupadd docker
sudo usermod -aG docker $USER

newgrp docker
docker run hello-world

è‡ªåŠ¨å¯åŠ¨
sudo systemctl enable docker.service
sudo systemctl enable containerd.service
ä¸è‡ªåŠ¨å¯åŠ¨
sudo systemctl disable docker.service
sudo systemctl disable containerd.service

äºŒã€å®‰è£…umi
sudo apt install -y libosmesa6-dev libgl1-mesa-glx libglfw3 patchelf
2.1åˆ›å»ºç¯å¢ƒ
cd universal_manipulation_interface/
sudo chown -R robot /opt/miniconda3
conda install mamba -n base -c conda-forge
å¤‡æ³¨ï¼šæˆ–è€…ç”¨conda install -n base conda-forge::mamba
mamba env create -f conda_environment.yaml
2.2å®‰è£…pipä¾èµ–ï¼ˆå‰é¢æ²¡å®‰è£…ï¼‰
conda activate umi
sudo apt install libspnav-dev spacenavd
systemctl start spacenavd
ä¿®æ”¹pip.conf
	[global]
	index-url = https://pypi.tuna.tsinghua.edu.cn/simple
	timeout = 120
ç„¶åï¼Œåˆ›å»ºrequirements.txtå¦‚ä¸‹ï¼š
	ray[default]==2.8.0
	threadpoolctl==3.2
	v4l2py==2.2
	ur-rtde==1.5.6
	# requires sudo apt install libspnav-dev spacenavd; systemctl start spacenavd
	spnav @ https://github.com/cheng-chi/spnav/archive/c1c938ebe3cc542db4685e0d13850ff1abfdb943.tar.gz
	atomics==1.0.2
	pynput==1.7.6
	fastcrc==0.2
	imagecodecs==2023.9.18
	robomimic==0.2.0
	# requires mujoco py dependencies libosmesa6-dev libgl1-mesa-glx libglfw3 patchelf
	free-mujoco-py==2.1.6
	robosuite @ https://github.com/cheng-chi/robosuite/archive/3f2c3116f1c0a1916e94bfa28da4d055927d1ab3.tar.gz
	# implicitly depend on conda package exiftool
	PyExifTool==0.5

pip install -r requirements.txt

pip install zerorpc


ä¸‰ã€åˆ›å»ºæ–‡ä»¶å¤¹ 
ï½/universal_manipulation_interfaceä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ example_demo_session
mkdir example_demo_session
åˆ°ç½‘ç«™https://real.stanford.edu/umi/data/example_demo_session/ä¸‹è½½å„å¤§è§†é¢‘


sudo apt update
sudo apt install docker.io

sudo groupadd docker
sudo usermod -aG docker $USER
sudo service docker restart
newgrp - docker


cd ~/universal_manipulation_interface
conda activate umi
python run_slam_pipeline.py example_demo_session





å››ã€ä½¿ç”¨
æ ¹æ®aruco_config.yamlå®Œæˆæ ‡å®š
æ›´æ–°gopro_intrinsics_2_7k.json





4.1 æ•°æ®å¤„ç†
æ•°æ®è‡ªåŠ¨ä¸‹è½½åï¼Œéœ€è¦æ”¾åˆ°å‰ä¸€ä¸ªç›®å½•ä¸‹
--universal_manipulation_interface
  â€¦â€¦
  --example_demo_session
    --raw_videos
    --demos
  â€¦â€¦
å…¶ä¸­raw_videoså­˜æ”¾é±¼çœ¼è§†é¢‘
4.1.1æ•°æ®å¯è§†åŒ–ï¼Œå¯æ‰“å¼€æŸ¥çœ‹ï¼ˆå½•åˆ¶çš„è§†é¢‘è½¬æ¢ä¸ºè§†é¢‘æ•°æ®+imuï¼‰
conda activate umi
python run_slam_pipeline.py umi/example_demo_session
è¾“å…¥å‚æ•°ä¸ºè§†é¢‘æ•°æ®çš„ç›®å½•å­˜æ”¾ä½ç½®
å¤„ç†æ•°æ®é€šå¸¸æ”¾äºraw_videos
4.1.2æ•°æ®é›†åˆ¶ä½œï¼ˆdataset.zarr.zipï¼‰
eg.
python scripts_slam_pipeline/07_generate_replay_buffer.py -o example_demo_session/dataset.zarr.zip example_demo_session
ä½¿ç”¨scripts_slam_pipeline/07_generate_replay_buffer.pyåˆ¶ä½œæ•°æ®é›†ï¼Œå®šä¹‰æ•°æ®é›†å­˜æ”¾ä½ç½®ï¼š-o example_demo_session/dataset.zarr.zip example_demo_session

python scripts_slam_pipeline/07_generate_replay_buffer.py -o example_demo_session/milk.zarr.zip example_demo_session


4.2 æœºæ¢°è‡‚+æœºæ¢°çˆªæ§åˆ¶ï¼Œå®ç°æ¯å­æ”¾ç½®
sudo chmod -R 777 /dev/bus/usb
python eval_real.py --robot_config=example/eval_robots_config.yaml -i cup_wild_vit_l_1img.ckpt -o data/eval_cup_wild_example
è„šæœ¬å¯åŠ¨åï¼Œä½¿ç”¨ç©ºæ ¼é¼ æ ‡æ§åˆ¶æœºå™¨äººå’ŒæŠ“æ‰‹ï¼ˆç©ºæ ¼é¼ æ ‡æŒ‰é’®ï¼‰ã€‚æŒ‰ å¯å¯åŠ¨ç­–ç•¥ã€‚æŒ‰ä¸‹åœæ­¢ã€‚CS

å¦‚æœä¸€åˆ‡è®¾ç½®æ­£ç¡®ï¼Œæ‚¨çš„æœºå™¨äººåº”è¯¥èƒ½å¤Ÿæ—‹è½¬æ¯å­å¹¶å°†å…¶æ”¾åœ¨ç¢Ÿå­ä¸Šçš„ä»»ä½•åœ°æ–¹ ğŸ‰

4.3 å•GPUè®­ç»ƒ
4.3.1è®­ç»ƒ
eg.
python train.py --config-name=train_diffusion_unet_timm_umi_workspace task.dataset_path=cup_in_the_wild.zarr.zip

python train.py --config-name=train_diffusion_unet_timm_umi_workspace task.dataset_path=milk.zarr.zip

æŠ¥é”™â€”â€”æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹ï¼Œå¹¶ä¿®æ”¹ä»£ç ï¼š
model/vision/timm_obs_encoder.pyä¸­
model = timm.create_model(
    model_name=model_name,
    pretrained=pretrained,
    global_pool=global_pool, # '' means no pooling
    num_classes=0            # remove classification layer
)
æ”¹æˆï¼š
model = timm.create_model(
    model_name=model_name,
    pretrained=True,
    pretrained_cfg_overlay=dict(file='/home/franka/universal_manipulation_interface_3/timm/vit_base_patch16_clip_224.openai'),
    global_pool=global_pool, # '' means no pooling
    num_classes=0            # remove classification layer
)

4.3.2 å¯è§†åŒ–
pip install wandb
åœ¨å®˜ç½‘æ³¨å†Œï¼š
å¤åˆ¶tokenï¼Œ
wandb login
æ ¹æ®æç¤ºè¾“å…¥token

æˆ–è€…ä¿®æ”¹ä»£ç ï¼š
# configure logging
wandb_run = wandb.init(
    dir=str(self.output_dir),
    config=OmegaConf.to_container(cfg, resolve=True),
    **cfg.logging
)
wandb.config.update(
    {
        "output_dir": self.output_dir,
    }
)




1.ç›¸æœºæ ‡å®š
pip install qrcode


